{"ast":null,"code":"import _classCallCheck from \"D:\\\\PROYECTOS\\\\recicla\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\PROYECTOS\\\\recicla\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"D:\\\\PROYECTOS\\\\recicla\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\PROYECTOS\\\\recicla\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\PROYECTOS\\\\recicla\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"D:\\\\PROYECTOS\\\\recicla\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"D:\\\\PROYECTOS\\\\recicla\\\\src\\\\components\\\\login\\\\LoginForm.js\";\n\n/**\r\n* CLASS LoginForm\r\n*\r\n* Contiene el formulario del login de la aplicacion\r\n*\r\n* @author Hector Morales <warrior1987@gmail.com>\r\n*/\nimport React, { Component } from 'react';\nimport './login.css';\nimport empresa_login from './../../images/empresa_login.png?v1.0';\nimport usuario_login from './../../images/usuario_login.png?v1.0';\nimport password_login from './../../images/password_login.png?v1.0';\nimport configJson from '../configuration/configuration.json';\nimport globalState from '../configuration/GlobalState';\nimport loadingImg from '../../images/loading.gif?v1.0';\nimport Modal from 'react-modal';\nimport Window from '../window/Window';\nimport { login, validaEmpresa } from '../api_calls/ApiCalls';\nimport alertify from 'alertifyjs';\nimport '../../css/alertify.css';\nvar stylesLoading = {\n  content: {\n    top: '50%',\n    left: '50%',\n    width: '202px',\n    height: '202px',\n    right: 'auto',\n    bottom: 'auto',\n    marginRight: '-50%',\n    padding: '0px',\n    transform: 'translate(-50%, -50%)'\n  }\n};\n\nvar LoginForm =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(LoginForm, _Component);\n\n  function LoginForm(props) {\n    var _this;\n\n    _classCallCheck(this, LoginForm);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LoginForm).call(this, props));\n    _this.inputEmpresa = React.createRef(); //traer los datos de inicio si ya estan en localstorage \n\n    var empresa = '';\n\n    if (localStorage.empresa > 0) {\n      empresa = localStorage.empresa;\n    }\n\n    var id_empresa = '';\n\n    if (localStorage.id_empresa > 0) {\n      id_empresa = localStorage.id_empresa;\n    }\n\n    var username = '';\n\n    if (localStorage.username !== '') {\n      username = localStorage.username;\n    }\n\n    _this.state = {\n      empresa: empresa,\n      id_empresa: id_empresa,\n      username: username,\n      password: '',\n      showLoading: false,\n      unmount: false\n    };\n    _this.handleLogin = _this.handleLogin.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(LoginForm, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      //cada que se monte el escritorio debe alistar la ventana del loading      \n      //... \n      this.unsubscribe1 = globalState.subscribe(function () {\n        if (globalState.getState().type === \"modalLoading1\") {\n          _this2.setState({\n            showLoading: globalState.getState().modalLoading1\n          });\n        }\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.unsubscribe1();\n    }\n  }, {\n    key: \"handleEnterLogin\",\n    value: function handleEnterLogin(event) {\n      //Pulsar enter        \n      var key = event.keyCode;\n\n      if (key === 13) {\n        this.handleLogin();\n      }\n    }\n  }, {\n    key: \"handleLogin\",\n    value: function handleLogin(val) {\n      var _this3 = this;\n\n      //validacion de datos       \n      if (this.state.empresa === undefined || this.state.empresa === '') {\n        alertify.error('Digite la empresa!');\n        return;\n      } else if (this.state.username === undefined || this.state.username === '') {\n        alertify.error('Digite el nombre de usuario!');\n        return;\n      } else if (this.state.password === undefined || this.state.password === '') {\n        alertify.error('Digite el password!');\n        return;\n      } //consulta si el usuario existe con los datos ingresados\n\n\n      login(this.state.id_empresa, this.state.username, this.state.password).then(function (res) {\n        var response = res.data;\n\n        if (response.msg === 'notExist') {\n          alertify.error('Datos de ingreso incorrectos!');\n        } else if (response.msg === 'error') {\n          alertify.alert('Error!', 'Ha ocurrido un error accesando a la base de datos!<br />Codigo de Error: ' + response.detail);\n        } else if (response.msg === 'accessDenied') {\n          alertify.error('El usuario no esta habilitado para acceder a esta empresa!');\n        } else {\n          //almacenar en localstorage los datos del login\n          localStorage.id_empresa = _this3.state.id_empresa;\n          localStorage.empresa = _this3.state.empresa;\n          localStorage.username = _this3.state.username;\n\n          _this3.props.history.push({\n            pathname: configJson.mainPath + 'desktop',\n            state: {\n              usuario: _this3.state.username,\n              empresa: _this3.state.empresa\n            }\n          });\n        }\n      }).catch(function (err) {\n        alertify.alert('Error!', 'No se ha logrado la conexion con el servidor!<br />' + err);\n      });\n    }\n  }, {\n    key: \"validacionEmpresa\",\n    value: function validacionEmpresa(val) {\n      var _this4 = this;\n\n      //consulta si la empresa existe        \n      validaEmpresa(this.state.empresa).then(function (res) {\n        var response = res.data;\n\n        if (response.msg === 'notExist') {\n          //aqui no me dejara continuar si la empresa noe xiste\n          alertify.error('La empresa no existe!');\n\n          _this4.inputEmpresa.current.focus();\n        } else if (response.msg === 'error') {\n          //aqui no me dejara continuar si hay un error\n          alertify.alert('Error!', 'Ha ocurrido un error accesando a la base de datos!<br />Codigo de Error: ' + response.detail);\n\n          _this4.inputEmpresa.current.focus();\n        } else {\n          _this4.setState({\n            id_empresa: response[0].id\n          }); //CARGAR EL ID EMPRESA                \n\n\n          alertify.success(response[0].razon_social);\n        }\n      }).catch(function (err) {\n        alertify.alert('Error!', 'No se ha logrado la conexion con el servidor!<br />' + err);\n\n        _this4.inputEmpresa.current.focus();\n      });\n    } //actualizacion de los datos del formulario\n\n  }, {\n    key: \"handleNitChange\",\n    value: function handleNitChange(e) {\n      this.setState({\n        empresa: e.target.value\n      });\n    }\n  }, {\n    key: \"handleUserChange\",\n    value: function handleUserChange(e) {\n      this.setState({\n        username: e.target.value\n      });\n    }\n  }, {\n    key: \"handlePasswordChange\",\n    value: function handlePasswordChange(e) {\n      this.setState({\n        password: e.target.value\n      });\n    }\n  }, {\n    key: \"handleOlvidoClave\",\n    value: function handleOlvidoClave(e) {\n      globalState.dispatch({\n        type: \"windowResetPassword1\",\n        params: {\n          visible: true,\n          params: {\n            email: '',\n            idWin: \"windowResetPassword1\" //identificador de la ventana\n\n          }\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return (//carga del formulario\n        React.createElement(\"form\", {\n          className: \"DivLogin\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 168\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"ContentField\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 169\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"FieldImage\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 170\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          alt: \"Empresa\",\n          src: empresa_login,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 171\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          className: \"FieldDiv\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 173\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          type: \"text\",\n          value: this.state.empresa,\n          className: \"inputLogin mytext\",\n          name: \"empresa\",\n          id: \"empresa\",\n          placeholder: \"NIT Empresa\",\n          required: true,\n          onBlur: this.validacionEmpresa.bind(this),\n          onChange: this.handleNitChange.bind(this),\n          ref: this.inputEmpresa,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 174\n          },\n          __self: this\n        }))), React.createElement(\"div\", {\n          className: \"ContentField\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"FieldImage\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          alt: \"Usuario\",\n          src: usuario_login,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 179\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          className: \"FieldDiv\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          type: \"text\",\n          value: this.state.username,\n          className: \"inputLogin mytext\",\n          name: \"usuario\",\n          id: \"usuario\",\n          placeholder: \"Usuario\",\n          required: true,\n          onChange: this.handleUserChange.bind(this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 182\n          },\n          __self: this\n        }))), React.createElement(\"div\", {\n          className: \"ContentField\",\n          styles: {\n            marginTop: '20px',\n            marginBottom: '20px'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 185\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"FieldImage\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 186\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          alt: \"Contrase\\xF1a\",\n          src: password_login,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 187\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          className: \"FieldDiv\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 189\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          type: \"password\",\n          className: \"inputLogin mytext\",\n          name: \"password\",\n          id: \"password\",\n          placeholder: \"Contrase\\xF1a\",\n          required: true,\n          onChange: this.handlePasswordChange.bind(this),\n          onKeyUp: this.handleEnterLogin.bind(this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 190\n          },\n          __self: this\n        }))), React.createElement(\"div\", {\n          className: \"ContentField\",\n          styles: {\n            padding: '5px 15px 10px',\n            margin: '0px',\n            textAlign: 'right'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          style: {\n            fontSize: '11px',\n            cursor: 'pointer',\n            fontWeight: 'bold',\n            color: '#848484',\n            textAlign: 'right',\n            paddingRight: '10px'\n          },\n          onClick: this.handleOlvidoClave.bind(this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 194\n          },\n          __self: this\n        }, \"Olvide mi Contrase\\xF1a\")), React.createElement(\"div\", {\n          className: \"DivBoton\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          type: \"button\",\n          id: \"validateUser\",\n          onClick: this.handleLogin.bind(this),\n          value: \" \",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 199\n          },\n          __self: this\n        })), React.createElement(Window, {\n          id: \"windowResetPassword1\",\n          title: \"Cambiar Password\",\n          width: \"300px\",\n          height: \"240px\",\n          tbar: \"false\",\n          componente: \"WindowResetPassword\",\n          params: \"\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 201\n          },\n          __self: this\n        }), React.createElement(Modal //la ventana del loading\n        , {\n          isOpen: this.state.showLoading,\n          contentLabel: \"Minimal Modal Example\",\n          style: stylesLoading,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 210\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          src: loadingImg,\n          alt: \"Loading\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 215\n          },\n          __self: this\n        })))\n      );\n    }\n  }]);\n\n  return LoginForm;\n}(Component);\n\nexport default LoginForm;","map":{"version":3,"sources":["D:\\PROYECTOS\\recicla\\src\\components\\login\\LoginForm.js"],"names":["React","Component","empresa_login","usuario_login","password_login","configJson","globalState","loadingImg","Modal","Window","login","validaEmpresa","alertify","stylesLoading","content","top","left","width","height","right","bottom","marginRight","padding","transform","LoginForm","props","inputEmpresa","createRef","empresa","localStorage","id_empresa","username","state","password","showLoading","unmount","handleLogin","bind","unsubscribe1","subscribe","getState","type","setState","modalLoading1","event","key","keyCode","val","undefined","error","then","res","response","data","msg","alert","detail","history","push","pathname","mainPath","usuario","catch","err","current","focus","id","success","razon_social","e","target","value","dispatch","params","visible","email","idWin","validacionEmpresa","handleNitChange","handleUserChange","marginTop","marginBottom","handlePasswordChange","handleEnterLogin","margin","textAlign","fontSize","cursor","fontWeight","color","paddingRight","handleOlvidoClave"],"mappings":"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","sourcesContent":["/**\r\n* CLASS LoginForm\r\n*\r\n* Contiene el formulario del login de la aplicacion\r\n*\r\n* @author Hector Morales <warrior1987@gmail.com>\r\n*/\r\n\r\nimport React, { Component } from 'react';\r\nimport './login.css';\r\nimport empresa_login from './../../images/empresa_login.png?v1.0';\r\nimport usuario_login from './../../images/usuario_login.png?v1.0';\r\nimport password_login from './../../images/password_login.png?v1.0';\r\nimport configJson from '../configuration/configuration.json';\r\nimport globalState from '../configuration/GlobalState';\r\nimport loadingImg from '../../images/loading.gif?v1.0';\r\nimport Modal from 'react-modal';\r\nimport Window from '../window/Window';\r\nimport {login,validaEmpresa} from '../api_calls/ApiCalls';\r\nimport alertify from 'alertifyjs';\r\nimport '../../css/alertify.css';\r\n\r\nconst stylesLoading = {\r\n  content : {\r\n    top         : '50%',\r\n    left        : '50%',\r\n    width       : '202px',\r\n    height      : '202px',\r\n    right       : 'auto',\r\n    bottom      : 'auto',\r\n    marginRight : '-50%',\r\n    padding     : '0px',\r\n    transform   : 'translate(-50%, -50%)',    \r\n  }\r\n};\r\n\r\nclass LoginForm extends Component {    \r\n    constructor(props) {\r\n        super(props);\r\n        this.inputEmpresa = React.createRef();\r\n        //traer los datos de inicio si ya estan en localstorage \r\n        let empresa = '';\r\n        if(localStorage.empresa > 0){\r\n            empresa = localStorage.empresa;\r\n        }           \r\n        let id_empresa = '';\r\n        if(localStorage.id_empresa > 0){\r\n            id_empresa = localStorage.id_empresa;\r\n        } \r\n        let username = '';\r\n        if(localStorage.username !== ''){\r\n            username = localStorage.username;\r\n        } \r\n        this.state = {\r\n            empresa: empresa,\r\n            id_empresa: id_empresa,\r\n            username: username,\r\n            password: '',\r\n            showLoading : false,\r\n            unmount : false,\r\n        };  \r\n        this.handleLogin = this.handleLogin.bind(this);\r\n    }\r\n    componentDidMount() {//cada que se monte el escritorio debe alistar la ventana del loading      \r\n        //... \r\n        this.unsubscribe1 = globalState.subscribe( ()=>{ \r\n            if(globalState.getState().type===\"modalLoading1\"){                 \r\n                this.setState({showLoading  : globalState.getState().modalLoading1});                                           \r\n            }\r\n        });          \r\n    } \r\n    componentWillUnmount(){ \r\n        this.unsubscribe1();\r\n    }\r\n    handleEnterLogin(event){//Pulsar enter        \r\n        let key = event.keyCode;        \r\n        if(key === 13){\r\n            this.handleLogin();\r\n        }\r\n    }   \r\n    handleLogin(val) {   \r\n        \r\n        //validacion de datos       \r\n        if(this.state.empresa === undefined || this.state.empresa === ''){\r\n            alertify.error('Digite la empresa!'); \r\n            return;\r\n        }\r\n        else if(this.state.username === undefined || this.state.username === ''){\r\n            alertify.error('Digite el nombre de usuario!'); \r\n            return;\r\n        }   \r\n        else if(this.state.password === undefined || this.state.password === ''){\r\n            alertify.error('Digite el password!'); \r\n            return;\r\n        }         \r\n        //consulta si el usuario existe con los datos ingresados\r\n        login(this.state.id_empresa,this.state.username,this.state.password)        \r\n        .then(res => {\r\n            var response = res.data; \r\n                      \r\n            if(response.msg === 'notExist'){\r\n                alertify.error('Datos de ingreso incorrectos!');                 \r\n            }\r\n            else if(response.msg === 'error'){\r\n                alertify.alert('Error!', 'Ha ocurrido un error accesando a la base de datos!<br />Codigo de Error: '+response.detail);\r\n            }\r\n            else if(response.msg === 'accessDenied'){\r\n                alertify.error('El usuario no esta habilitado para acceder a esta empresa!');\r\n            }\r\n            else{                \r\n                //almacenar en localstorage los datos del login\r\n                localStorage.id_empresa = this.state.id_empresa;\r\n                localStorage.empresa    = this.state.empresa;\r\n                localStorage.username   = this.state.username;\r\n                this.props.history.push({pathname: configJson.mainPath+'desktop', state : { usuario : this.state.username,empresa : this.state.empresa }}); \r\n            }          \r\n        }) \r\n        .catch( err => {            \r\n            alertify.alert('Error!', 'No se ha logrado la conexion con el servidor!<br />'+err);            \r\n        })\r\n    }\r\n    validacionEmpresa(val) {        \r\n        //consulta si la empresa existe        \r\n        validaEmpresa(this.state.empresa)        \r\n        .then(res => {\r\n            var response = res.data;                       \r\n            if(response.msg === 'notExist'){//aqui no me dejara continuar si la empresa noe xiste\r\n                alertify.error('La empresa no existe!'); \r\n                this.inputEmpresa.current.focus();\r\n            }\r\n            else if(response.msg === 'error'){//aqui no me dejara continuar si hay un error\r\n                alertify.alert('Error!', 'Ha ocurrido un error accesando a la base de datos!<br />Codigo de Error: '+response.detail);\r\n                this.inputEmpresa.current.focus();\r\n            }\r\n            else{\r\n                this.setState({id_empresa: response[0].id}); //CARGAR EL ID EMPRESA                \r\n                alertify.success(response[0].razon_social);                \r\n            }          \r\n        }) \r\n        .catch( err => {            \r\n            alertify.alert('Error!', 'No se ha logrado la conexion con el servidor!<br />'+err);\r\n            this.inputEmpresa.current.focus();\r\n        })\r\n    }//actualizacion de los datos del formulario\r\n    handleNitChange(e) { \r\n        this.setState({empresa: e.target.value}); \r\n    }\r\n    handleUserChange(e) { \r\n        this.setState({username: e.target.value}); \r\n    }\r\n    handlePasswordChange(e) { \r\n        this.setState({password: e.target.value}); \r\n    } \r\n    handleOlvidoClave(e) {\r\n        globalState.dispatch({\r\n                type   : \"windowResetPassword1\",\r\n                params : {\r\n                              visible : true,\r\n                              params  : {\r\n                                            email : '',\r\n                                            idWin : \"windowResetPassword1\"//identificador de la ventana\r\n                                        }\r\n                         }\r\n            }); \r\n    }\r\n    render() {\r\n        return (//carga del formulario\r\n            <form className=\"DivLogin\">\r\n                <div className=\"ContentField\">\r\n                    <div className=\"FieldImage\">\r\n                        <img alt=\"Empresa\" src={ empresa_login } />\r\n                    </div>\r\n                    <div className=\"FieldDiv\">\r\n                        <input type=\"text\" value={this.state.empresa} className=\"inputLogin mytext\" name=\"empresa\" id=\"empresa\" placeholder=\"NIT Empresa\" required onBlur={this.validacionEmpresa.bind(this)} onChange={this.handleNitChange.bind(this)}  ref={this.inputEmpresa}/>\r\n                    </div>\r\n                </div>\r\n                <div className=\"ContentField\">\r\n                    <div className=\"FieldImage\">\r\n                        <img alt=\"Usuario\" src={ usuario_login } />\r\n                    </div>\r\n                    <div className=\"FieldDiv\">\r\n                        <input type=\"text\" value={this.state.username} className=\"inputLogin mytext\" name=\"usuario\" id=\"usuario\" placeholder=\"Usuario\" required onChange={this.handleUserChange.bind(this)}/>\r\n                    </div>\r\n                </div>\r\n                <div className=\"ContentField\" styles= {{marginTop: '20px',marginBottom: '20px'}}>\r\n                    <div className=\"FieldImage\">\r\n                        <img alt=\"Contraseña\" src={ password_login } />\r\n                    </div>\r\n                    <div className=\"FieldDiv\">\r\n                        <input type=\"password\" className=\"inputLogin mytext\" name=\"password\" id=\"password\" placeholder=\"Contraseña\" required onChange={this.handlePasswordChange.bind(this)} onKeyUp={this.handleEnterLogin.bind(this)}/>\r\n                    </div>\r\n                </div>\r\n                <div className=\"ContentField\" styles={{padding:'5px 15px 10px', margin:'0px', textAlign:'right'}}>\r\n                    <div style={{fontSize:'11px',cursor:'pointer',fontWeight:'bold',color:'#848484',textAlign:'right',paddingRight:'10px'}} onClick={this.handleOlvidoClave.bind(this)}>\r\n                        Olvide mi Contrase&ntilde;a\r\n                    </div>\r\n                </div>\r\n                <div className=\"DivBoton\">\r\n                    <input type=\"button\" id=\"validateUser\" onClick={this.handleLogin.bind(this)} value=\" \" />\r\n                </div>\r\n                <Window \r\n                    id = \"windowResetPassword1\"                      \r\n                    title='Cambiar Password'\r\n                    width='300px' \r\n                    height='240px'                     \r\n                    tbar='false'\r\n                    componente=\"WindowResetPassword\"\r\n                    params=\"\" \r\n                />\r\n                <Modal //la ventana del loading\r\n                   isOpen={this.state.showLoading}\r\n                   contentLabel=\"Minimal Modal Example\"\r\n                   style={stylesLoading}\r\n                > \r\n                    <img src={loadingImg}  alt=\"Loading\"/>\r\n                </Modal>\r\n            </form>           \r\n        );\r\n    }\r\n}\r\n\r\nexport default LoginForm"]},"metadata":{},"sourceType":"module"}